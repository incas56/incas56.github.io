<h2>Handsoap with <span class="caps">ASP</span>.Net</h2>
<p class="publish_date">30 Sep 2009</p>
<p>Soap4r wasn&#8217;t unusable for me but I didn&#8217;t like using it. When things lined up correctly everything was rosy but trying to debug when a problem occurred was very difficult.  <a href="http://github.com/troelskn/handsoap">Handsoap</a> to the rescue.</p>
<p>Handsoap doesn&#8217;t try to do your work for you, it just tries to get out of the way and perform the lower level http calls while providing a toolbox and pattern to help you generate xml requests and parse xml responses.  I&#8217;m not going to give a further description.  I just want to walk through how I use it with <span class="caps">ASP</span>.Net web services.</p>
<h3>Use <span class="caps">ASP</span>.net Previews</h3>
<p><span class="caps">ASP</span>.net 2.0 &#8220;.asmx&#8221; files get rendered in a browser as a human readable list of <span class="caps">SOAP</span> methods. When you click on a method name it renders a helpful set of <span class="caps">SOAP</span> 1.1 and <span class="caps">SOAP</span> 1.2 sample request and response.</p>
<p><img src="/images/asmx_method_list.png" title="List of ASP.Net Methods" alt="List of ASP.Net Methods" /></p>
<p><img src="/images/asmx_samples.png" title="List of ASP.Net sample request and response" alt="List of ASP.Net sample request and response" /></p>
<h3>Tests to Parse the Response</h3>
<p>I don&#8217;t write tests to ensure my requests are correct.  I should but for now I just test that I am parsing the response correctly.  This example just returns a simple string so I copy the sample response <span class="caps">XML</span> from the web service and paste it into a test like below and replace the place holder &#8220;string&#8221; with a sample value &#8220;jojojo&#8221;:</p>
<pre name="code" class="ruby">
    def test_get_user_info_result
        response_xml = '
        <soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">
          <soap:Body>
            <GetUserInfoResponse xmlns="http://spokt.com/">
              <GetUserInfoResult>jojojo</GetUserInfoResult>
            </GetUserInfoResponse>
          </soap:Body>
        </soap:Envelope>'

        api = SpoktApi.new
        mock_response(api, response_xml)
        
        result = api.get_user_info("dan")
        assert_equal('jojojo', result)
    end
      

</pre><p>The mock_response method is in my test helper:</p>
<pre name="code" class="ruby">
  def mock_response(api, xml)
    response = Handsoap::Http::Response.new(200,[],xml)
    api.expects(:send_http_request).returns(response)
  end
</pre>