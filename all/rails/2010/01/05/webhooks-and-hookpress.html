<h2>Webhooks and Hookpress</h2>
<p class="publish_date">05 Jan 2010</p>
<blockquote>
<p>Webhooks: so simple you&#8217;ll think they&#8217;re stupid.<br />
<span class="attributed">&#8212; Jeff Lindsay</span></p>
</blockquote>
<p>A couple weeks ago we launched blog.spokt.com and we wanted to have links to recent blog posts in the footer at spokt.com (hosted on different servers):</p>
<p><img src="/images/posts-in-footer.png" title="recent blog posts listed in spokt.com footer" alt="recent blog posts listed in spokt.com footer" /></p>
<p>To accomplish this I created a url at spokt which when accessed would download the blog&#8217;s rss feed, parse it, and store it for later listing.  I then used my nearly-zero wordpress &amp; php experience to create plugin that just curl&#8217;d the url.  Here&#8217;s the plugin code:</p>
<pre name="code" class="php">
	&lt;?php

	function notify_spokt() {
		$ch = curl_init('http://spokt.com/blog_update');
		curl_setopt( $ch, CURLOPT_RETURNTRANSFER, 1 );
		curl_setopt( $ch, CURLOPT_HEADER, 0 );
		$page = curl_exec($ch);
		curl_close($ch);
	}

	add_filter('publish_post','notify_spokt');

	?&gt;
</pre>
<p>I thought that this kind of functionality might be useful and considered investigating how to make the url configurable.</p>
<p>Yesterday I learned about <a href="http://www.webhooks.org/">webhooks</a> and thought about how I might go about creating a wordpress plugin using the &#8220;hooks&#8221; already built in and exposing them as webhooks. I figured someone probably already had and sure enough: the <a href="http://wordpress.org/extend/plugins/hookpress/">hookpress plugin</a> by Michael 芳貴 Erlewine</p>
<p>Once installed Click &#8220;Settings&#8221; in the wp admin then the &#8220;Webhooks&#8221; link. That will bring up an easy-to-use admin interface. Click &#8220;Add webhook&#8221; then choose your action, any fields you want to pass, and enter the url.</p>
<p>See Also: <a href="http://mitcho.com/code/hookpress/">Useful hookpress screencast by Michael 芳貴 Erlewine</a></p>
<p><img src="/images/hookpress-screenshot.png" title="easy to use admin interface" alt="easy to use admin interface" /></p>
<p>On the rails server this class stores the information I need for my links in a background process. BlogPost is an ActiveRecord class:</p>
<pre name="code" class="ruby">
require 'rss/2.0'
require 'open-uri'

class FeedReader
  attr_accessor :uri
  def initialize(feed_url)
    self.uri = feed_url
  end
  
  def process
    BlogPost.destroy_all
    feed_items.each do |item|
      BlogPost.create(:title=&gt;item.title,:href=&gt;item.link,:description=&gt;item.description, :publish_date =&gt; item.pubDate.to_s)
    end  
  end

  def feed_items
    items = []
    open(self.uri) do |http|
      response = http.read
      result = RSS::Parser.parse(response, false)
      return result.items
    end
  end

end
</pre>